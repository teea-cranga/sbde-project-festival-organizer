DROP TABLE TERENURI CASCADE CONSTRAINTS;
DROP TABLE CONSTRUCTII CASCADE CONSTRAINTS;
DROP TABLE INFO_CONSTRUCTII CASCADE CONSTRAINTS;

-- CREARE TABELE
CREATE TABLE TERENURI(
ID_TEREN NUMBER CONSTRAINT PK_TID PRIMARY KEY,
TIP_TEREN VARCHAR2(9) CONSTRAINT CK_TTIP CHECK (TIP_TEREN IN('ASFALT','IARBA','PIETRIS','INTRARE')), --MANDATORY CONCRETE, GRASS, GRAVEL
NUME_TEREN VARCHAR2(50) CONSTRAINT NN_NUMET NOT NULL, --POATE SA FIE CAMPING, PARCARE, SAU PERIMETRUL FESTIVALULUI (IMPARTIT IN ZONE IN FUNCTIE DE TIPUL DE TEREN)
FORMA_TEREN SDO_GEOMETRY
);

CREATE TABLE CONSTRUCTII(
ID_CONSTRUCTIE NUMBER CONSTRAINT PK_CONST PRIMARY KEY,
COD_CONSTRUCTIE NUMBER CONSTRAINT NN_CODC NOT NULL, -- COD INFORMATIV PENTRU MAP VIEW
FORMA_CONSTRUCTIE SDO_GEOMETRY,
ID_TEREN NUMBER REFERENCES TERENURI(ID_TEREN)
);

CREATE TABLE INFO_CONSTRUCTII(
ID_CONSTRUCTIE NUMBER REFERENCES CONSTRUCTII(ID_CONSTRUCTIE),
TIP_CONSTRUCTIE VARCHAR2(100) CONSTRAINT CK_CTIP CHECK(TIP_CONSTRUCTIE IN('TOALETA','CORT MANCARE','CORT MERCH','SCENA', 'BAR','PRIM AJUTOR', 'BIROU INFORMATII','ZONA MESE')), 
-- BIROU INFORMATII (COD 1), CORT MANCARE (COD 2), BARURI (COD 3), PRIM AJUTOR (COD 4), CORT MERCH (COD 5), TOALETE (COD 6),MESE (COD 7), SCENA (COD 8)
NUME_FIRMA VARCHAR2(100) CONSTRAINT NN_NUMEF NOT NULL,
CAPACITATE NUMBER,
DESCRIERE VARCHAR2(100)
);

--INSERT PENTRU TERENURI
INSERT INTO TERENURI VALUES(
    1,
    'INTRARE',
    'INTRARE VIZITATORI',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(4,1, 9,4)
    )
);

INSERT INTO TERENURI VALUES(
    2,
    'ASFALT',
    'TEREN RECREERE SCENE 1 SI 2',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(4,4, 16,4, 21,9, 21,12, 4,12, 4,4)
    )
);

INSERT INTO TERENURI VALUES(
    3,
    'PIETRIS',
    'ZONA SCENE 1 SI 2',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(4,12, 21,17)
    )
);

INSERT INTO TERENURI VALUES(
    4,
    'ASFALT',
    'ZONA TRANSFER SCENA 3',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(4,17, 6,17, 13,22, 13,35, 10,35, 10,25, 4,22, 4,17)
    )
);

INSERT INTO TERENURI VALUES(
    5,
    'IARBA',
    'ZONA SCENA 3',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(4,32, 10,41)
    )
);

INSERT INTO TERENURI VALUES(
    6,
    'ASFALT',
    'TEREN RECREERE SCENA 3',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(10,35, 15,41)
    )
);

INSERT INTO TERENURI VALUES(
    7,
    'INTRARE',
    'INTRARE TRUPE',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(12,17, 15,19)
    )
);


INSERT INTO TERENURI VALUES(
    8,
    'IARBA',
    'ZONA CAMPING',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(25,18, 35,34)
    )
);

INSERT INTO TERENURI VALUES(
    9,
    'ASFALT',
    'PARCARE MASINI',
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(25,8, 35,18)
    )
);

SELECT * FROM TERENURI;

-- insert constructii
INSERT INTO CONSTRUCTII VALUES( -- birou informatii intrare
    1,
    1,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(8,2, 9,4)
    ),
    1
);

INSERT INTO CONSTRUCTII VALUES( -- mancare scene 1 si 2
    2,
    2,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(15,5, 16,5, 20,9, 19,9, 15,5)
    ),
    2
);

INSERT INTO CONSTRUCTII VALUES( -- mancare transfer scene
    3,
    2,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(10,25, 11,30)
    ),
    4
);

INSERT INTO CONSTRUCTII VALUES( -- baruri scenele 1 si 2
    4,
    3,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(19,10, 21,12)
    ),
    2
);

INSERT INTO CONSTRUCTII VALUES( -- baruri pasaj scene
    5,
    3,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(10,20, 13,22, 12,23, 9,21, 10,20)
    ),
    4
);
 
INSERT INTO CONSTRUCTII VALUES( -- baruri scena 3
    6,
    3,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(10,40, 14,41)
    ),
    5
);

INSERT INTO CONSTRUCTII VALUES( --prim ajutor
    7,
    4,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(18,15, 20,17)
    ),
    3
);


INSERT INTO CONSTRUCTII VALUES( -- merch trupe scene 1 si 2
    8,
    5,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(10,4, 14,5)
    ),
    2
);

INSERT INTO CONSTRUCTII VALUES( -- merch trupe transfer scene
    9,
    5,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(7,18, 10,20, 9,21, 6,19, 7,18)
    ),
    4
);

INSERT INTO CONSTRUCTII VALUES( -- toalete scene 1 si 2
    10,
    6,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(4,7, 6,10)
    ),
    2
);

INSERT INTO CONSTRUCTII VALUES( -- toalete scena 3
    11,
    6,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(13,35, 15,36)
    ),
    6
);

INSERT INTO CONSTRUCTII VALUES( -- mese scene 1 si 2
    12,
    7,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(12,7, 14,7, 18,11, 16,11, 12,7)
    ),
    2
);

INSERT INTO CONSTRUCTII VALUES( -- mese pasaj
    13,
    7,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,1),
    SDO_ORDINATE_ARRAY(5,21, 11,24, 10,25, 4,22, 5,21)
    ),
    4
);

INSERT INTO CONSTRUCTII VALUES( -- mese teren 3
    14,
    7,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(4,37, 6,41)
    ),
    5
);

INSERT INTO CONSTRUCTII VALUES( -- scena 1
    15,
    8,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(7,14, 12,17)
    ),
    3
);

INSERT INTO CONSTRUCTII VALUES( -- scena 2
    16,
    8,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(12,14, 17,17)
    ),
    3
);

INSERT INTO CONSTRUCTII VALUES( -- scena 3
    17,
    8,
    SDO_GEOMETRY(
    2003,
    NULL,
    NULL,
    SDO_ELEM_INFO_ARRAY(1,1003,3),
    SDO_ORDINATE_ARRAY(5,32, 10,34)
    ),
    5
);

--insert pentru info_constructii
INSERT INTO INFO_CONSTRUCTII VALUES (1, 'BIROU INFORMATII', 'Cranga Ana-Teea', 4, 'Biroul de informatii de la intrare');
INSERT INTO INFO_CONSTRUCTII VALUES (2, 'CORT MANCARE', 'Bucate pe Roate', 10, 'Cortul de mancare de la scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (3, 'CORT MANCARE', 'Bucate pe Roate', 10, 'Cortul de mancare de la scena 3');
INSERT INTO INFO_CONSTRUCTII VALUES (4, 'BAR', 'Barock', 6, 'Barul de la scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (5, 'BAR', 'Bariton', 6, 'Barul de la pasajul intre scene');
INSERT INTO INFO_CONSTRUCTII VALUES (6, 'BAR', 'Rockstadt SRL', 4, 'Barul de la scena 3');
INSERT INTO INFO_CONSTRUCTII VALUES (7, 'PRIM AJUTOR', 'Medicare', 8, 'Centru prim ajutor, scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (8, 'CORT MERCH', 'Stage Tech', 10, 'Cort de merch trupe scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (9, 'CORT MERCH', 'Stage Tech', 8, 'Cort de merch trupe scena 3');
INSERT INTO INFO_CONSTRUCTII VALUES (10, 'TOALETA', 'Clean Expert SRL', 6, 'Toaleta scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (11, 'TOALETA', 'Clean Expert SRL', 6, 'Toaleta scena 3');
INSERT INTO INFO_CONSTRUCTII VALUES (12, 'ZONA MESE', 'Stage Tech', 150, 'Zona mese scenele 1 si 2');
INSERT INTO INFO_CONSTRUCTII VALUES (13, 'ZONA MESE', 'Stage Tech', 150, 'Zona mese pasajul intre scene');
INSERT INTO INFO_CONSTRUCTII VALUES (14, 'ZONA MESE', 'Stage Tech', 90, 'Zona mese scena 3');
INSERT INTO INFO_CONSTRUCTII VALUES (15, 'SCENA', 'Stage Tech', 20, 'Scena 1');
INSERT INTO INFO_CONSTRUCTII VALUES (16, 'SCENA', 'Stage Tech', 20, 'Scena 2');
INSERT INTO INFO_CONSTRUCTII VALUES (17, 'SCENA', 'Stage Tech', 20, 'Scena 3');

SELECT * FROM INFO_CONSTRUCTII;
-- viziunile standard de metadate
INSERT INTO user_sdo_geom_metadata
    (TABLE_NAME,
     COLUMN_NAME,
     DIMINFO,
     SRID)
  VALUES (
  'terenuri',
  'forma_teren',
  SDO_DIM_ARRAY(   
    SDO_DIM_ELEMENT('X', 0, 50, 0.005),
    SDO_DIM_ELEMENT('Y', 0, 50, 0.005)
     ),
  4326  
);

INSERT INTO user_sdo_geom_metadata
    (TABLE_NAME,
     COLUMN_NAME,
     DIMINFO,
     SRID)
  VALUES (
  'constructii',
  'forma_constructie',
  SDO_DIM_ARRAY(   
    SDO_DIM_ELEMENT('X', 0, 50, 0.005),
    SDO_DIM_ELEMENT('Y', 0, 50, 0.005)
     ),
  4326  
);

SELECT * FROM USER_SDO_GEOM_METADATA;

--indecsii spatiali
CREATE INDEX IDX_TERENURI ON TERENURI(FORMA_TEREN)
INDEXTYPE IS MDSYS.SPATIAL_INDEX;

CREATE INDEX IDX_CONSTRUCTII ON CONSTRUCTII(FORMA_CONSTRUCTIE)
INDEXTYPE IS MDSYS.SPATIAL_INDEX;


--Vizualizarea datelor spaţiale în Map View, sub diverse criteri
/*
    1. Sa se afiseze in Map View constructiile situate pe terenul 4 
*/
SELECT * FROM CONSTRUCTII 
WHERE ID_TEREN = 4;
    
/*
    2. Sa se afiseze in Map View constructiile care au capacitatea mai mare de 10 persoane 
    si sunt pe terenurile 2 si 3
*/
SELECT C.ID_CONSTRUCTIE, C.FORMA_CONSTRUCTIE, CAPACITATE FROM CONSTRUCTII C 
JOIN INFO_CONSTRUCTII I ON I.ID_CONSTRUCTIE = C.ID_CONSTRUCTIE
WHERE (ID_TEREN = 2 OR ID_TEREN = 3) AND CAPACITATE > 10;

/*
    3. Sa se creeze un layer in Map View cu terenurile unite 
*/

SELECT sdo_aggr.sdo_aggr_set_union 
  (CURSOR(SELECT FORMA_TEREN FROM TERENURI), 0.005 )
FROM dual;

-- ca sa fie compatibil cu Map View
CREATE TABLE ARIE_TOTALA_FESTIVAL AS SELECT sdo_aggr.sdo_aggr_set_union 
  (CURSOR(SELECT FORMA_TEREN FROM TERENURI), 0.005 ) ARIE_TOTALA
FROM dual;


--Alte interogari spatiale

/*
    4. Sa se calculeze distanta de la scene la cea mai apropiata baie. (distanta e raportata 1:5m)
*/
SET SERVEROUTPUT ON;
DECLARE
    CURSOR C IS SELECT ID_CONSTRUCTIE, DESCRIERE FROM INFO_CONSTRUCTII WHERE TIP_CONSTRUCTIE = 'SCENA';
    REZULTAT NUMBER; 
BEGIN
    FOR I IN C LOOP
        SELECT 5 * ROUND(MIN(SDO_GEOM.SDO_DISTANCE(C1.FORMA_CONSTRUCTIE, C2.FORMA_CONSTRUCTIE, 0.005))) INTO REZULTAT
        FROM CONSTRUCTII C1, CONSTRUCTII C2
        WHERE C2.ID_CONSTRUCTIE = I.ID_CONSTRUCTIE
        AND C1.ID_CONSTRUCTIE IN(SELECT ID_CONSTRUCTIE FROM INFO_CONSTRUCTII WHERE TIP_CONSTRUCTIE = 'TOALETA');
        DBMS_OUTPUT.PUT_LINE('DISTANTA DINTRE '|| I.DESCRIERE || ' SI CEA MAI APROPIATA TOALETA ESTE ' || REZULTAT || 'M');
    END LOOP;
END;
/

/*
    5. Sa se calculeze cat % din aria festivalului este ocupata de constructii. Terenurile 8 si 9 nu sunt incluse
*/

DECLARE
    ARIE_TEREN NUMBER;
    ARIE_CONSTRUCTII NUMBER;
BEGIN
    SELECT SUM(SDO_GEOM.SDO_AREA(FORMA_CONSTRUCTIE, 0.005)) INTO ARIE_CONSTRUCTII FROM CONSTRUCTII;
    SELECT SUM(SDO_GEOM.SDO_AREA(FORMA_TEREN, 0.005)) INTO ARIE_TEREN FROM TERENURI WHERE ID_TEREN NOT IN(8,9);
    DBMS_OUTPUT.PUT_LINE('PROCENTAJUL DE TEREN AL FESTIVALULUI ACOPERIT ESTE DE ' || ROUND(ARIE_CONSTRUCTII/ARIE_TEREN*100,2) || '%');
END;
/

/*
    6. Sa se determine care este suprafata de intersectie dintre terenuri si cladirile care se afla pe acestea 
*/

SELECT T.ID_TEREN, NUME_TEREN, SUM(SDO_GEOM.SDO_AREA(SDO_GEOM.SDO_INTERSECTION(FORMA_TEREN, FORMA_CONSTRUCTIE, 0.005),0.005)) AS ARIE_OCUPATA_CLADIRI
FROM TERENURI T
JOIN CONSTRUCTII C ON C.ID_TEREN = T.ID_TEREN
GROUP BY T.ID_TEREN, NUME_TEREN;

/*
    7. Calculeaza distanta de la intrarea in festival la orice cort de pe teren (presupunem ca punctul de la care calculam este 6,4)
*/

SELECT 5 * SDO_GEOM.SDO_DISTANCE(
 SDO_GEOMETRY(
    SDO_POINT2D,
    NULL,
    SDO_POINT_TYPE(6,1,NULL),
    NULL,
    NULL
    ),
 FORMA_CONSTRUCTIE, 0.005) AS DISTANTA_IN_M, DESCRIERE, NUME_FIRMA
 FROM CONSTRUCTII C
 JOIN INFO_CONSTRUCTII I ON I.ID_CONSTRUCTIE=C.ID_CONSTRUCTIE;
    
/*
    8. Afiseaza constructiile care stau pe marginile festivalului (au cel putin o latura care se intersecteaza cu aria festivalului)
*/

SELECT C.* FROM CONSTRUCTII C
JOIN TERENURI T ON T.ID_TEREN = C.ID_TEREN
WHERE SDO_GEOM.RELATE(FORMA_TEREN,'COVERS', FORMA_CONSTRUCTIE,0.005) = 'COVERS'
ORDER BY ID_CONSTRUCTIE; 

/*
    9. Sa se calculeze aria ocupata de fiecare tip de constructie
*/

--varianta cu PARTITION BY
SELECT DISTINCT TIP_CONSTRUCTIE, COD_CONSTRUCTIE, 
SUM(SDO_GEOM.SDO_AREA(FORMA_CONSTRUCTIE ,0.005)) OVER(partition by cod_constructie) AS ARIE_CONSTRUCTII
FROM CONSTRUCTII C
JOIN INFO_CONSTRUCTII I ON I.ID_CONSTRUCTIE = C.ID_CONSTRUCTIE;

--varianta cu GROUP BY
SELECT TIP_CONSTRUCTIE, COD_CONSTRUCTIE, SUM(SDO_GEOM.SDO_AREA(FORMA_CONSTRUCTIE ,0.005)) FROM CONSTRUCTII C
JOIN INFO_CONSTRUCTII I ON C.ID_CONSTRUCTIE = I.ID_CONSTRUCTIE
GROUP BY TIP_CONSTRUCTIE, COD_CONSTRUCTIE;


/*
    10. Sa se afiseze perimetrul si forma minima de acoperire a constructiilor de tip cort mancare si baruri
*/

SELECT SDO_AGGR_CONVEXHULL(
         SDOAGGRTYPE(C.FORMA_CONSTRUCTIE, 0.005)
       ),
SDO_GEOM.SDO_LENGTH(SDO_AGGR_CONVEXHULL(
         SDOAGGRTYPE(C.FORMA_CONSTRUCTIE, 0.005)
       ),0.005)
FROM CONSTRUCTII C
JOIN INFO_CONSTRUCTII I ON C.ID_CONSTRUCTIE = I.ID_CONSTRUCTIE
WHERE I.TIP_CONSTRUCTIE IN ('CORT MANCARE','BAR');

/*
    11. Sa se determine ce cladiri se afla in poligonul buffer al oricarei cladiri (input de la utilizator) (presupunem ca bufferul va fi de 3m)
*/

DECLARE 
    V_BUFFER SDO_GEOMETRY;
    TYPE REZ_ARRAY IS VARRAY (17) OF NUMBER;
    R_ARRAY REZ_ARRAY;
BEGIN
    SELECT SDO_GEOM.SDO_BUFFER(FORMA_CONSTRUCTIE, 3, 0.005) INTO V_BUFFER FROM CONSTRUCTII WHERE ID_CONSTRUCTIE = :p_var;
    SELECT ID_CONSTRUCTIE BULK COLLECT INTO R_ARRAY FROM CONSTRUCTII WHERE SDO_GEOM.RELATE(V_BUFFER, 'ANYINTERACT', FORMA_CONSTRUCTIE, 0.005) = 'TRUE';
    FOR I IN 1..R_ARRAY.COUNT LOOP
         dbms_output.PUT_LINE(R_ARRAY(i));
    END LOOP;
END;
/

/*
    12. Sa se determine aria "libera" a festivalului
*/

SELECT 
    SUM(SDO_GEOM.SDO_AREA(SDO_GEOM.SDO_DIFFERENCE(T.FORMA_TEREN, C.FORMA_CONSTRUCTIE, 0.005),0.005)) AS ARIE_LIBERA
FROM TERENURI T
JOIN CONSTRUCTII C ON C.ID_TEREN = T.ID_TEREN;


/*
    13. Sa se determine distanta dintre centrul corturilor (merch, bar, mancare) si scene
*/

SELECT C1.ID_CONSTRUCTIE, 5 * SDO_GEOM.SDO_DISTANCE(SDO_GEOM.SDO_CENTROID(C2.FORMA_CONSTRUCTIE, 0.005),C1.FORMA_CONSTRUCTIE, 0.005) AS DIST_DE_LA_CENTROID_LA_SCENA
FROM CONSTRUCTII C1, CONSTRUCTII C2
WHERE C1.ID_CONSTRUCTIE IN (SELECT ID_CONSTRUCTIE FROM INFO_CONSTRUCTII WHERE TIP_CONSTRUCTIE = 'SCENA')
AND C2.ID_CONSTRUCTIE IN (SELECT ID_CONSTRUCTIE FROM INFO_CONSTRUCTII WHERE TIP_CONSTRUCTIE LIKE 'CORT%' OR TIP_CONSTRUCTIE = 'BAR');


/*
    14. Calculati diametrul maxim al constructiilor 
*/

SELECT TIP_CONSTRUCTIE, 5 * MAX(SDO_GEOM.SDO_DIAMETER(C.FORMA_CONSTRUCTIE, 0.005)) AS DIAMETRU_CONSTRUCTIE
FROM CONSTRUCTII C
JOIN INFO_CONSTRUCTII I ON C.ID_CONSTRUCTIE = I.ID_CONSTRUCTIE
GROUP BY TIP_CONSTRUCTIE;


/*
    15. Sa se calculeze distanta maxima de la centrul de prim ajutor la toate scenele
*/

SELECT C1.ID_CONSTRUCTIE AS DE_LA, C2.ID_CONSTRUCTIE AS PANA_LA, 5* SDO_GEOM.SDO_MAXDISTANCE(C1.FORMA_CONSTRUCTIE, C2.FORMA_CONSTRUCTIE, 0.005) AS DIST_MAXIMA
FROM CONSTRUCTII C1, CONSTRUCTII C2
WHERE C1.COD_CONSTRUCTIE = 4 AND C2.COD_CONSTRUCTIE = 8;

/*
    16. Sa se afiseze o linie cu distanta maxima de la zonele de camping/parcare la intrarea de oaspeti (teorema lui Pitagora) :)
*/

SELECT T1.NUME_TEREN AS DE_LA,T2.NUME_TEREN AS PANA_LA, 
SDO_GEOM.SDO_MAXDISTANCE_LINE(T1.FORMA_TEREN, T2.FORMA_TEREN, 0.005) AS LINIE,
5 * SDO_GEOM.SDO_MAXDISTANCE(T1.FORMA_TEREN, T2.FORMA_TEREN, 0.005) AS DISTANTA
FROM TERENURI T1, TERENURI T2
WHERE T1.NUME_TEREN IN('ZONA CAMPING','PARCARE MASINI') AND T2.NUME_TEREN = 'INTRARE VIZITATORI';

CREATE TABLE LINII_MAX AS SELECT T1.NUME_TEREN AS DE_LA,T2.NUME_TEREN AS PANA_LA, 
SDO_GEOM.SDO_MAXDISTANCE_LINE(T1.FORMA_TEREN, T2.FORMA_TEREN, 0.005) AS LINIE
FROM TERENURI T1, TERENURI T2
WHERE T1.NUME_TEREN IN('ZONA CAMPING','PARCARE MASINI') AND T2.NUME_TEREN = 'INTRARE VIZITATORI';

